-- -------------------------------------------------------
-- standard library expected from the target platform
-- -------------------------------------------------------
class stdlib
    -- -------------------------------------------------------
    -- string functions
    -- -------------------------------------------------------
    public static extern len(s : string) : int;
    public static extern indexOf(s : string, sub:string) : int;
    public static extern left(s : string, length : int) : string;
    public static extern trim(s : string) : string;
    public static extern right(s : string, length : int) : string;
    public static extern substring(s : string, from : int, length : int) : string;
    public static extern match(s : string, re : string) : boolean;
    public static extern parse(s : string, re : string) : string[];
    public static extern unicode(s : string) : int;
    public static extern char(unicode : int) : string;

    -- -------------------------------------------------------
    -- integer functions
    -- -------------------------------------------------------
    public static extern iabs(x : int) : int;
    public static extern isgn(x : int) : int;

    -- -------------------------------------------------------
    -- real functions
    -- -------------------------------------------------------
    public static extern abs(x : real) : real;
    public static extern sgn(x : real) : int;
    public static extern sin(x : real) : real;
    public static extern cos(x : real) : real;
    public static extern tan(x : real) : real;
    public static extern asin(x : real) : real;
    public static extern acos(x : real) : real;
    public static extern atan(x : real) : real;
    public static extern atan2(x : real, y : real) : real;
    public static extern sqrt(x : real) : real;
    public static extern ceil(x : real, digits : int) : real;
    public static extern floor(x : real, digits : int) : real;
    public static extern round(x : real, digits : int) : real;

    -- ---------------------------------------------------------
    -- date/time function
    -- ---------------------------------------------------------
    public static extern mkdate(year : int, month : int, day : int) : datetime;
    public static extern mkdatetime(year : int, month : int, day : int, hour : int, minute : int, second : int, milliseconds : int) : datetime;
    public static extern day(x : datetime) : int;
    public static extern dayOfWeek(x : datetime) : int;
    public static extern month(x : datetime) : int;
    public static extern year(x : datetime) : int;
    public static extern leapYear(x : datetime) : boolean;
    public static extern hour(x : datetime) : int;
    public static extern minute(x : datetime) : int;
    public static extern second(x : datetime) : int;
    public static extern seconds(x : datetime) : real;
    public static extern millisecond(x : datetime) : int;
    public static extern nowlocal() : datetime;
    public static extern nowutc() : datetime;
    
    -- JDN
    -- Julian Day number
    -- The integer part is Julian day number
    -- https://en.wikipedia.org/wiki/Julian_day#Converting_Gregorian_calendar_date_to_Julian_Day_Number
    -- The fractional part is the part of the day (hour * 3600 + minute * 60 + seconds) / 86400.0
    public static extern toJdn(x : datetime) : real;
    public static extern fromJdn(x : real) : datetime;

    public static extern print(x : string) : void;
end

-- -------------------------------------------------------
-- Filesystem functions
-- -------------------------------------------------------
class io
    public static extern exists(filename : string) : boolean;
    public static extern size(filename : string) : real;
    public static extern isFolder(filename : string) : boolean;
    public static extern isFile(filename : string) : boolean;
    public static extern files(path : string) : string[];
    public static extern folders(path : string) : string[];
    public static extern delete(path : string) : void;
    public static extern writeTextToFile(path : string, text : string, codepage : int) : void;
    public static extern readTextFromFile(path : string, codepage : int) : string;
    public static extern tempFolder() : string;
    public static extern combinePath(p1 : string, p2 : string) : string;
    public static extern fullPath(p1 : string) : string;
    public static extern currentDirectory() : string;
    public static extern createFolder(name : string) : void;

    -- open modes
    const M_OPEN = 1;    -- open existing file
    const M_CREATE = 2;  -- create if not exist
    const M_NEW = 4;     -- delete file if exist
    const M_READ = 16;
    const M_WRITE = 32;
    const M_READWRITE = 48;
    const M_SHARE_READ = 64;
    const M_SHARE_WRITE = 128;
    const M_SHARE = 192;
    const CP_ANSI = 437;
    const CP_UTF7 = 65000;
    const CP_UTF8 = 65001;
    public static extern open(filename : string, mode : int, codepage : int) : file;
end

-- ------------------------------------------------------- 
-- Binary buffer
-- -------------------------------------------------------
class buffer
    public extern length() : int;
    public extern get(index : int) : int;
    public extern set(index : int, value : int) : void;
    public static extern create(length : int) : buffer;
end

-- -------------------------------------------------------
-- File i/o
-- -------------------------------------------------------
class file
    public extern length() : int;
    public extern getPosition() : int;
    public extern seek(position : int) : void;
    public extern readLine() : string;
    public extern read() : int;
    public extern readBuffer(length : int) : buffer;
    public extern writeLine(v : string) : int;
    public extern write(v : int) : int;
    public extern writeBuffer(v : buffer) : int;
end

-- -------------------------------------------------------
-- CSV file parser
-- -------------------------------------------------------
class csvParser
    public extern setSeparator(separator : string) : void;
    public extern getSeparator() : string;
    
    public extern setAllowStrings(flag : boolean) : void;
    public extern getAllowString() : boolean;
    
    public extern setAllowComments(flag : boolean) : void;
    public extern getAllowComments() : boolean;
    public extern setCommentPrefix(commentPrefix : string) : void;
    public extern getCommentPrefix() : string;

    public extern splitLine(line : string) : string[];
    public static extern create() : csvParser;
end

-- -------------------------------------------------------
-- XML node
-- -------------------------------------------------------
class xmlNode
    -- Get node type
    -- node could be element, text, comment, cdata, attribute
    public extern getType() : string;
    public extern getName() : string;
    public extern getValue() : string;
    public extern getChildrenCount() : int;
    public extern getChild(index : int) : xmlNode;
end

-- -------------------------------------------------------
-- XML parser
-- -------------------------------------------------------
class xmlParser
    public extern parse(xml : string) : xmlNode;
    public static extern create() : xmlParser;
end

-- -------------------------------------------------------
-- object list
-- -------------------------------------------------------
class list
    public extern length() : int;
    public extern get(index : int) : object;
    public extern set(index : int, value : object) : void;
    public extern add(value : object) : void;
    public extern insert(index : int, value : object) : void;
    public extern remove(index : int) : void;
    public extern clear() : void;
    public extern toArray() : object[];
    public extern list() : void;
    public static extern create(initial : object[]) : list;
end

-- ----------------------------------------------------------
-- int -> object map
-- ----------------------------------------------------------
class int_map 
    public extern length() : int;
    public extern contains(key : int) : boolean;
    public extern get(key : int) : object;
    public extern set(key : int, value : object) : void;
    public extern remove(key : int) : void;
    public extern keys() : int[];
    public extern clear() : void;
end

-- ----------------------------------------------------------
-- string -> object map
-- ----------------------------------------------------------
class string_map 
    public extern length() : int;
    public extern contains(key : string) : boolean;
    public extern get(key : string) : object;
    public extern set(key : string, value : object) : void;
    public extern remove(key : string) : void;
    public extern keys() : string[];
    public extern clear() : void;
end

-- -----------------------------------------------------------
-- Queue 
-- -----------------------------------------------------------
class queue
    public extern length() : int;
    public extern enqueue(value : object) : void;
    public extern peek() : object;
    public extern dequeue() : object;
    public extern clear() : void;
    public extern queue() : void;
end

-- -----------------------------------------------------------
-- Stack 
-- -----------------------------------------------------------
class stack
    public extern length() : int;
    public extern push(value : object) : void;
    public extern peek() : object;
    public extern pop() : object;
    public extern clear() : void;
    public extern stack() : void;
end

-- ------------------------------------------------------------
-- action class
-- ------------------------------------------------------------
@Interface()
class action
    public function invoke() : void
    end
end

-- -----------------------------------------------------------
-- assertion class
-- -----------------------------------------------------------
class assert
   public static extern isTrue(condition : boolean, message : string) : void;
   public static extern isFalse(condition : boolean, message : string) : void;

   public static extern throws(action : action, message : string) : void;
   public static extern doesNotThrow(action : action, message : string) : void;
end